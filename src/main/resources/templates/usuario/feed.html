<script>
	//falta que cuando se comente se carguen los comentarios
// 	function leer(objeto) {

// 		objeto.parentNode.parentNode.children[1].style.height = "auto";

// 		objeto.text = "Leer menos";

// 		objeto.onclick = function() {
// 			objeto.parentNode.parentNode.children[1].style.height = "200px";
// 			objeto.text = "Leer m�s";
// 			objeto.onclick = function() {
// 				leer(objeto);
// 			};

// 		};
// 	}

	//Waves

	/*window.onload = function(){
		
		$(document).ready(function(){
			$.ajax({
				url: "",
				type: "get",
				success
				
			});
		});
		
	}*/

	function wave(w) {
		
		var idPublicacion = w.id.slice(5,);
		
		var badge= w.previousSibling;
		
		if (w.style.color == "black") {
			w.style.color = "#f90d4e";
			badge.removeAttribute("class");
			badge.setAttribute("class", "badge badge-danger");
			w.previousSibling.innerText = parseInt(w.previousSibling.innerText)+1;
			
			var parametros = {
				"idPublicacion" : idPublicacion,
			}

			$(document).ready(function() {
				$.ajax({
					data : parametros,
					url : '/crearWave', //archivo que recibe la peticion
					type : 'post', //método de envio

				});
			});

		} else {
			w.style.color = "black";
			badge.removeAttribute("class");
			badge.setAttribute("class", "badge badge-secondary")
			w.previousSibling.innerText = parseInt(w.previousSibling.innerText)-1;

			var parametros = {
				"idPublicacion" : idPublicacion,
			}

			$(document).ready(function() {
				$.ajax({
					data : parametros, //datos que se envian a traves de ajax
					url : '/borrarWave', //archivo que recibe la peticion
					type : 'post', //método de envio

				});
			});

		}

	}
	//Comentarios
	
	
// 	https://unipython.com/ajax-dentro-del-ciclo-for-en-java-script/
	
		var divs = document.getElementsByClassName("comentarioss");
		var idPublicacion=[];
var opcion=0;
		
	function verComentarios(indice) {

	
		if(opcion ==0){
			for ( var i = divs.length-1; i >= 0; i--) {
				

			idPublicacion += divs[i].parentNode.children[0].children[2].value;
			}
			
			console.log(idPublicacion);
	}else{
		if(indice < divs.length){
			$.ajax({
				data : {idPublicacion : idPublicacion[indice]},
				url : "/verComentarios",
				type : "GET",
			}).done(function(comentarios){
					divs[i].value="";
					divs[i].style.height="200px";
					divs[i].style.overflowY="auto";
					divs[i].innerHTML = comentarios;
					console.log(comentarios);
					verComentarios(indice + 1)
				
					console.log(idPublicacion[indice]+"asdas");
			
			});
			}
	}
		}

    window.onload = verComentarios;	
// 			 $.ajax({
// 				 type : 'GET',
// 				 url : '/verComentarios',
// 				 data : parametros,
// 				 success : function (comentarios) {
// 					 div.value="";
// 					 div.style.height="200px";
// 					 div.style.overflowY="auto";
// 					 div.innerHTML = comentarios;
// 					 console.log(div);
// 				 }
// 				 });

		//}
		
	
	function comentar(btn) {
		var comentario = btn.previousSibling.previousSibling.previousSibling.previousSibling.value;
		btn.previousSibling.previousSibling.previousSibling.previousSibling.value = "";

		var idPublicacion = btn.previousSibling.previousSibling.value;

		var divReal = btn.parentNode.parentNode.lastElementChild;

		var parametros = {
			"comentario" : comentario,
			"idPublicacion" : idPublicacion
		}

		console.log(divReal);
		
		$(document).ready(function() {

			$.ajax({
				data : parametros,
				url : "/crearComentario",
				type : "post",
				success : function(comentarios) {
					console.log(comentarios);
					divReal.innerHTML = comentarios;

				}

			});
		});

	}
	
  
	
		
	
// 	$(document).ready(function() {

// 		var idPublicacion = document.getElementsByClassName("comentarioss")[0];
		
// 		$.ajax({
// 			data : {
// 				"idPublicacion" : idPublicacion,
// 			},
// 			url : "/verComentarios",
// 			type : "get",
// 			success : function(comentarios) {
// 				console.log(comentarios);
// 				divReal.innerHTML = comentarios;

// 			}

// 		});

// 	});

</script>
<div class="col-lg">
	<div id="centro" class=" justify-content-center align-items-center">
		<!-- 			cargar publicaciones -->
		<div th:each="publicacion: ${publicaciones}">
			<div class="d-flex justify-content-center" id="perfiles">
				<div id="borde-perfil"
					class="d-flex justify-content-center align-items-center">

					<div
						class="card card-feed d-flex justify-content-center align-items-center">


						<!-- 				img solo desde static -->
						<div th:if="${publicacion.tipoContenido}=='img'">
							<img class="card-img feed-img"
								th:src="@{${publicacion.contenido}}">
						</div>

						<!-- 		Para video -->
						<div th:if="${publicacion.tipoContenido}=='video'"
							class="card-film feed-film">
							<video width="500px" height="300px" controls>
								<source th:src="@{${publicacion.contenido}}" type="video/mp4" />
							</video>
						</div>



						<div th:if="${publicacion.tipoContenido}=='audio'"
							class="card-audio feed-audio">
							<audio th:src="@{${publicacion.contenido}}" controls
								type="audio/mpeg">
							</audio>
						</div>


						<div class="row d-flex justify-content-center align-items-center">
							<div class="card-body feed-body">
								<div class="card-tittle feed-tittle p-0 mt-3 mb-1">
									<img class="foto-post col-5"
										th:src="@{${publicacion.duenioPublicacion.fotoPerfil}}">
									<a
										th:href="@{/user/{loginName}(loginName=${publicacion.duenioPublicacion.loginName})}"><b
										th:text="${publicacion.duenioPublicacion.loginName}"></b></a> <small
										class="text-muted float-right mt-3 " id="fecha"
										th:text="${publicacion.fechaPublicacion.toLocalDate}"></small>
								</div>
								<div class="card-text feed-text">
									<p class="text-break" th:id="${publicacion.id}"
										th:text="${publicacion.descripcion}"></p>
								</div>
								<!-- 								<div class="leer-mas"> -->
								<!-- 									<a class="leer" onclick="leer(this)">Leer más</a> -->
								<!-- 								</div> -->

								<div class="card-footer text-right d-flexbox">
									<div class="icons">
										<div class="row justify-content-end align-items-center"
											th:if="${#arrays.contains(publicacionesWaved, publicacion.id)}">
											<b th:text=${publicacion.cantidadWaves}
												class="badge badge-secondary"></b><i
												th:id="|wave-${publicacion.id}|"
												style="color: #f90d4e; font-size: 2em;"
												class="bi bi-soundwave" role="button" onclick="wave(this)"></i>
										</div>
										<div class="row justify-content-end align-items-center"
											th:unless="${#arrays.contains(publicacionesWaved, publicacion.id)}">
											<b th:text=${publicacion.cantidadWaves}
												class="badge badge-secondary"></b><i
												th:id="|wave-${publicacion.id}|"
												style="color: black; font-size: 2em;"
												class="bi bi-soundwave" role="button" onclick="wave(this)"></i>
										</div>
									</div>

									<div class="form-group justify-content-end align-items-center">
										<div class="d-flex justify-content-between pt-4 comentarios">
											<img class="foto-perfil col-2"
												th:src="@{${session.userLogged.fotoPerfil}}"> <input
												type="text" class="form-control col-6"
												placeholder="Comentar" name="comentario" id="comentario" />
											<input type="hidden" th:value="${publicacion.id}" /> <input
												type="button" class=" btn-hover btn-red" value="Comentar"
												onClick="comentar(this)" />

											<!-- 											<div th:id="|coment-${publicacion.id}|" -->
											<!-- 												class="cargaComentarios"> -->
											<!-- 												<input type="hidden" th:value="${publicacion.id}" -->
											<!-- 													name="idPublicacionWave" /> -->
											<!-- 											</div> -->
										</div>

										<!-- 											//hacer condicional para el tamaño -->

										<div class="comentarioss mt-3 text-center">
											<span>No hay comentarios en esta publicación</span>
										</div>


									</div>
									<!--Comentarios -->


								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>