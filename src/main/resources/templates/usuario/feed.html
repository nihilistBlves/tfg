<script>

	function wave(w) {
		
		var idPublicacion = w.id.slice(5,);
		
		var badge= w.previousSibling;
		
		if (w.style.color == "black") {
			w.style.color = "#f90d4e";
			badge.removeAttribute("class");
			badge.setAttribute("class", "badge badge-danger");
			w.previousSibling.innerText = parseInt(w.previousSibling.innerText)+1;
			
			var parametros = {
				"idPublicacion" : idPublicacion,
			}

			$(document).ready(function() {
				$.ajax({
					data : parametros,
					url : '/crearWave', //archivo que recibe la peticion
					type : 'post', //método de envio

				});
			});

		} else {
			w.style.color = "black";
			badge.removeAttribute("class");
			badge.setAttribute("class", "badge badge-secondary")
			w.previousSibling.innerText = parseInt(w.previousSibling.innerText)-1;

			var parametros = {
				"idPublicacion" : idPublicacion,
			}

			$(document).ready(function() {
				$.ajax({
					data : parametros, //datos que se envian a traves de ajax
					url : '/borrarWave', //archivo que recibe la peticion
					type : 'post', //método de envio

				});
			});

		}

	}

	function llamada(divsComentarios, idPublicacion, contador) {
		var parametros = {
				"idPublicacion": idPublicacion,
		}
		$(document).ready(function() {
			$.ajax({
				async: "true",
				data : parametros,
				url : "/verComentarios",
				type : "get",
				success : function(comentarios) {
					if(comentarios==""){
						divsComentarios[contador].style.height="30px";
						divsComentarios[contador].innerHTML ="No hay comentarios en esta publicación";
					}else{
						divsComentarios[contador].innerHTML = comentarios;
					}
					
					
				}

			});
		});
	}

    window.onload = function() {
    	var divsComentarios = document.getElementsByClassName("comentarioss");
    	for (var i = 0; i < divsComentarios.length; i++) {
    		var idPublicacion = divsComentarios[i].parentNode.children[0].children[2].value;
    		llamada(divsComentarios, idPublicacion, i);
    	}
    }		
		
		
	
	function comentar(btn) {
		var comentario = btn.previousSibling.previousSibling.previousSibling.previousSibling.value;
		btn.previousSibling.previousSibling.previousSibling.previousSibling.value = "";

		var idPublicacion = btn.previousSibling.previousSibling.value;

		var divReal = btn.parentNode.parentNode.lastElementChild;

		var parametros = {
			"comentario" : comentario,
			"idPublicacion" : idPublicacion
		}

		console.log(divReal);
		
		$(document).ready(function() {

			$.ajax({
				data : parametros,
				url : "/crearComentario",
				type : "post",
				success : function(comentarios) {
					console.log(comentarios);
					divReal.innerHTML = comentarios;

				}

			});
		});

	}

</script>
<div class="col-lg">
	<div id="centro" class=" justify-content-center align-items-center">
		<!-- 			cargar publicaciones -->
		<div th:each="publicacion: ${publicaciones}">
			<div class="d-flex justify-content-center" id="perfiles">
				<div id="borde-perfil"
					class="d-flex justify-content-center align-items-center">

					<div
						class="card card-feed d-flex justify-content-center align-items-center">

						<!-- 				img solo desde static -->
						<div th:if="${publicacion.tipoContenido}=='img'">
							<img class="card-img feed-img"
								th:src="|data:image;base64,${publicacion.contenido}|">
						</div>

						<!-- 		Para video -->
						<div th:if="${publicacion.tipoContenido}=='video'"
							class="card-film feed-film">
							<video width="500px" height="300px" controls>
								<source th:src="|data:video;base64,${publicacion.contenido}|" type="video/mp4" />
							</video>
						</div>



						<div th:if="${publicacion.tipoContenido}=='audio'"
							class="card-audio feed-audio">
							<audio th:src="|data:audio;base64,${publicacion.contenido}|" controls
								type="audio/mpeg">
							</audio>
						</div>


						<div class="row d-flex justify-content-center align-items-center">
							<div class="card-body feed-body">
								<div class="card-tittle feed-tittle p-0 mt-3 mb-1">
									<img class="foto-post col-5"
										th:src="@{${publicacion.duenioPublicacion.fotoPerfil}}">
									<a
										th:href="@{/user/{loginName}(loginName=${publicacion.duenioPublicacion.loginName})}"><b
										th:text="${publicacion.duenioPublicacion.loginName}"></b></a>
									<small class=" text-muted float-right mt-3 " id="fecha"
										th:text="${publicacion.fechaPublicacion.toLocalDate}"></small>
								</div>
								<div class="card-text feed-text">
									<p class="text-break p-4" th:id="${publicacion.id}"
										th:text="${publicacion.descripcion}"></p>
								</div>
								<!-- 								<div class="leer-mas"> -->
								<!-- 									<a class="leer" onclick="leer(this)">Leer más</a> -->
								<!-- 								</div> -->

								<div class="card-footer text-right d-flexbox">
									<div class=" col-12 icons d-inline-flex justify-content-between aligns-items-center">
										<form
										th:action="@{/publicacion/{id}/reportar(id=${publicacion.id})}"
										method="get">
										<button class="btn btn-outline-danger  m-2 btn-sm">
											<i class="bi bi-exclamation-triangle"></i>
										</button>
									</form>
										<div class="row justify-content-end align-items-center"
											th:if="${#arrays.contains(publicacionesWaved, publicacion.id)}">
											<b th:text=${publicacion.cantidadWaves}
												class="badge badge-secondary"></b><i
												th:id="|wave-${publicacion.id}|"
												style="color: #f90d4e; font-size: 2em;"
												class="bi bi-soundwave" role="button" onclick="wave(this)"></i>
										</div>
										<div class="row justify-content-end align-items-center"
											th:unless="${#arrays.contains(publicacionesWaved, publicacion.id)}">
											<b th:text=${publicacion.cantidadWaves}
												class="badge badge-secondary"></b><i
												th:id="|wave-${publicacion.id}|"
												style="color: black; font-size: 2em;"
												class="bi bi-soundwave" role="button" onclick="wave(this)"></i>
										</div>
									</div>

									<div class="form-group justify-content-end align-items-center">
										<div class="d-flex justify-content-between aligns-items-center pt-4 comentarios">
											<img class="foto-perfil col-2"
												th:src="@{${session.userLogged.fotoPerfil}}"> <input
												type="text" class="form-control col-6"
												placeholder="Comentar" name="comentario" id="comentario" />
											<input type="hidden" th:value="${publicacion.id}" /> <input
												type="button" class=" btn-hover btn-red" value="Comentar"
												onClick="comentar(this)" />

											<!-- 											<div th:id="|coment-${publicacion.id}|" -->
											<!-- 												class="cargaComentarios"> -->
											<!-- 												<input type="hidden" th:value="${publicacion.id}" -->
											<!-- 													name="idPublicacionWave" /> -->
											<!-- 											</div> -->
										</div>

										<!-- 											//hacer condicional para el tamaño -->

										<div class="comentarioss mt-3 text-center">
											<span>No hay comentarios en esta publicación</span>
										</div>


									</div>
									<!--Comentarios -->


								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>